{"version":3,"file":"plugin.js","mappings":"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","sources":["webpack://zyllio-plugin-datagrid/./src/datagrid.component.ts","webpack://zyllio-plugin-datagrid/./src/datagrid.metadata.ts"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nconsole.log('Plugin Datagrid started 2');\nimport { DataGridMetadata } from \"./datagrid.metadata\";\nimport CssContent from './datagrid.component.css';\nconst PlusIcon = `\r\n  <svg class=\"button\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\"><path fill=\"currentColor\" d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\" /></svg>\r\n`;\nclass DataGridComponent extends HTMLElement {\n    set data(data) {\n        console.log(\"set data \", data);\n        if (this._data === undefined) {\n            this._data = data;\n        }\n    }\n    set selection(selection) {\n        console.log(\"set selection \", selection);\n        this._selection = selection;\n    }\n    constructor() {\n        super();\n        this.search = '';\n        this.shadow = this.attachShadow({ mode: 'open' });\n        this.htmlElement = document.createElement('div');\n        this.htmlElement.className = 'content';\n        this.styleElement = document.createElement('style');\n    }\n    connectedCallback() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.shadow.appendChild(this.styleElement);\n            this.shadow.appendChild(this.htmlElement);\n            this.styleElement.innerHTML = CssContent;\n            yield this.refresh();\n        });\n    }\n    refresh() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.htmlElement.innerHTML = yield this.getHtmlContent();\n            setTimeout(() => {\n                this.postRefresh();\n            });\n        });\n    }\n    getFilteredData() {\n        const result = this._data.items\n            .filter(item => Object.values(item).some(value => value.toLowerCase().includes(this.search.toLowerCase())));\n        return result;\n    }\n    getHtmlContent() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const columns = this.getColumns();\n            const filteredData = this.getFilteredData();\n            return `\r\n\r\n      <div class=\"toolbar\">        \r\n        <zyllio-sdk-search value=\"${this.search}\" ></zyllio-sdk-search>\r\n      </div>\r\n\r\n      <table>\r\n        <thead><tr>\r\n          <th><div class=\"header\" ></div></th></th>\r\n          ${columns.map(column => `<th><div class=\"header\" >${column.name}</div></th>`).join('')}\r\n        </tr></thead>\r\n\r\n        <tbody>\r\n        ${filteredData.map((item, rowIndex) => `\r\n          \r\n          <tr>\r\n            <td>${rowIndex + 1}</td>\r\n            ${columns.map((column, columnIndex) => `\r\n\r\n              <td>\r\n                <div class=\"cell\" data-row=\"${rowIndex}\" data-id=\"${item._id}\" data-column-name=\"${column.name}\" data-column=\"${columnIndex}\" >\r\n                  <div class=\"text\" ${!this.isOptionsColumn(column) ? 'contenteditable' : ''} >${item[column.name]}</div>\r\n                  ${(this.isOptionsColumn(column)) ? `<div class=\"menu\" >\r\n                      ${column.options.split(',').map((option) => `<div class=\"option\" >${option}</div>`)}                      \r\n                    </div>` : ''}\r\n                </div>\r\n              </td> \r\n            \r\n              `).join('')}\r\n          <tr>\r\n\r\n        `).join('')} \r\n\r\n        ${(filteredData.length === 0) ? `<tr><td></td><td colspan=\"100\" class=\"no-data\" ><div>Aucune donn√©e disponible</div></td></tr>` : ''}\r\n        </tbody>         \r\n      </table>\r\n\r\n      <!-- ${PlusIcon}  -->      \r\n    `;\n        });\n    }\n    isOptionsColumn(column) {\n        return column.type === 'options-1' || column.type === 'options-n';\n    }\n    postRefresh() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.shadow.querySelectorAll('div[data-row]').forEach(cell => {\n                cell.addEventListener('click', (event) => {\n                    //  console.log(\"event \", event);\n                    // Delay to give a chance to unblur to select / update\n                    // const cell = (event.target as HTMLElement).closest('.cell') as HTMLElement\n                    // setTimeout( () => {\n                    // this.onCellClick(cell)\n                    // })\n                });\n            });\n            this.shadow.querySelectorAll('div[data-row] .text').forEach(cell => {\n                cell.addEventListener('keydown', (event) => {\n                    this.onCellkeydown(event);\n                });\n                cell.addEventListener('blur', (event) => {\n                    this.onCellBlur(event);\n                });\n            });\n            this.shadow.querySelectorAll('.option').forEach(option => {\n                option.addEventListener('click', (event) => {\n                    this.onOptionClick(event);\n                });\n            });\n            this.shadow.querySelector('zyllio-sdk-search').onblur = () => {\n                this.search = this.shadow.querySelector('zyllio-sdk-search').value;\n                this.refresh();\n            };\n            /*this.shadow.querySelector<HTMLElement>('.button')!.onclick = () => {\n        \n              this.dispatchEvent(new CustomEvent('trigger-action', {\n                detail: { action: 'create-action' }\n              }))\n        \n              setTimeout(() => {\n                this.dispatchEvent(new CustomEvent('refresh-data'))\n              }, 1000)\n            }*/\n        });\n    }\n    onCellkeydown(event) {\n        // Emp√™che le comportement par d√©faut (ajout d'un <div>)\n        if (event.key === 'Enter') {\n            event.preventDefault();\n            const br = document.createElement('br');\n            const selection = window.getSelection();\n            const range = selection.getRangeAt(0);\n            range.deleteContents();\n            range.insertNode(br);\n            range.setStartAfter(br);\n            range.collapse(true);\n            selection.removeAllRanges();\n            selection.addRange(range);\n        }\n    }\n    onOptionClick(event) {\n        event.stopPropagation();\n        const option = event.target;\n        const cell = option.closest('.cell');\n        const value = option.innerText;\n        const columnName = cell.dataset.columnName;\n        this._selection[columnName] = value;\n        cell.querySelector('.text').textContent = value;\n        console.log(\"Updating (from option click)... \", this._selection);\n        this.dispatchEvent(new CustomEvent('selected', { detail: { selection: this._selection } }));\n        this.dispatchEvent(new CustomEvent('trigger-action', {\n            detail: { action: 'update-action' }\n        }));\n        cell.classList.remove('selected');\n    }\n    onCellBlur(event) {\n        const cell = event.target.closest('.cell');\n        const value = event.target.innerText;\n        const columnName = cell.dataset.columnName;\n        const rowId = cell.dataset.id;\n        const row = this._data.items.find(item => item._id === rowId);\n        row[columnName] = value;\n        console.log(\"Updating (from onblur)... \", row);\n        this.dispatchEvent(new CustomEvent('selected', { detail: { selection: row } }));\n        this.dispatchEvent(new CustomEvent('trigger-action', {\n            detail: { action: 'update-action' }\n        }));\n    }\n    onCellClick(cell) {\n        // const cell = (event.target as HTMLElement).closest('.cell') as HTMLElement\n        //  console.log(\"cell \", cell);\n        if (cell.classList.contains('selected')) {\n            return;\n        }\n        this.shadow.querySelectorAll('div[data-row]').forEach(cell => {\n            cell.classList.remove('selected');\n        });\n        cell.classList.add('selected');\n        const selection = this._data.items.find(i => i._id === cell.dataset.id);\n        console.log(\"selecting (from onclick)... \", selection);\n        this.dispatchEvent(new CustomEvent('selected', { detail: { selection } }));\n    }\n    getColumns() {\n        return this._data.table.columns.filter(c => c.type !== 'relation-1' && c.type !== 'relation-n');\n    }\n}\nzySdk.services.registry.registerComponent(DataGridMetadata, DataGridComponent);\n","const IconData = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"#cccccc\">    \r\n    <path d=\"M10,4V8H14V4H10M16,4V8H20V4H16M16,10V14H20V10H16M16,16V20H20V16H16M14,20V16H10V20H14M8,20V16H4V20H8M8,14V10H4V14H8M8,8V4H4V8H8M10,14H14V10H10V14M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4C2.92,22 2,21.1 2,20V4A2,2 0 0,1 4,2Z\" />\r\n  </svg> \r\n`;\nexport const DataGridMetadata = {\n    id: 'custom-datagrid',\n    metadataVersion: 2,\n    icon: IconData,\n    label: 'Data grid',\n    category: 'Plugins',\n    subCategory: 'Plugins',\n    hidden: false,\n    properties: [{\n            id: 'selection',\n            name: 'Selection',\n            type: 'row-variable',\n            tootip: '',\n            default: '',\n            write: true\n        }, {\n            id: 'data',\n            name: 'Table',\n            type: 'table',\n            tootip: 'The table being used to populate',\n            default: '',\n            main: true\n        }, {\n            id: 'filter',\n            name: 'Filter',\n            type: 'filter',\n            tootip: 'Filter the table rows',\n            default: ''\n        }, {\n            id: 'update-action',\n            name: 'Update action',\n            type: 'action',\n            tootip: '',\n            default: ''\n        } /*, {\n          id: 'create-action',\n          name: 'Create action',\n          type: 'action',\n          tootip: '',\n          default: ''\n        }, {\n          id: 'delete-action',\n          name: 'Delete action',\n          type: 'action',\n          tootip: '',\n          default: ''\n        }*/\n    ],\n    styles: []\n};\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","console","log","DataGridComponent","HTMLElement","data","undefined","this","_data","selection","_selection","constructor","super","search","shadow","attachShadow","mode","htmlElement","document","createElement","className","styleElement","connectedCallback","appendChild","innerHTML","refresh","getHtmlContent","setTimeout","postRefresh","getFilteredData","items","filter","item","Object","values","some","toLowerCase","includes","columns","getColumns","filteredData","map","column","name","join","rowIndex","columnIndex","_id","isOptionsColumn","options","split","option","length","type","querySelectorAll","forEach","cell","addEventListener","event","onCellkeydown","onCellBlur","onOptionClick","querySelector","onblur","key","preventDefault","br","window","getSelection","range","getRangeAt","deleteContents","insertNode","setStartAfter","collapse","removeAllRanges","addRange","stopPropagation","target","closest","innerText","columnName","dataset","textContent","dispatchEvent","CustomEvent","detail","action","classList","remove","rowId","id","row","find","onCellClick","contains","add","i","table","c","zySdk","services","registry","registerComponent","metadataVersion","icon","label","category","subCategory","hidden","properties","tootip","default","write","main","styles"],"sourceRoot":""}