{"version":3,"file":"plugin.js","mappings":"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","sources":["webpack://zyllio-plugin-datagrid/./src/datagrid.component.ts","webpack://zyllio-plugin-datagrid/./src/datagrid.metadata.ts"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nconsole.log('Plugin Datagrid started');\r\nimport { DataGridMetadata } from \"./datagrid.metadata\";\r\nconst CssContent = `\r\n\r\n  :host {\r\n    display: block;\r\n    overflow: hidden;\r\n    width: 100%;\r\n    padding: 10px 10px;\r\n    box-sizing: border-box;\r\n    font-family: var(--theme-font-family);\r\n    --gray: #aeaeae;\r\n    --cell-width: 150px;\r\n    --scrollbar-background: #fff;\r\n    --scrollbar-foreground: #b1b1b1;\r\n  }\r\n  \r\n  .content {\r\n    overflow-x: auto;\r\n  }\r\n\r\n  table {\r\n    font-size: 16px;\r\n    border-collapse: collapse;\r\n    table-layout: fixed;\r\n  }\r\n\r\n  th { \r\n    border: 1px solid var(--gray); \r\n    text-align: left;    \r\n  }\r\n\r\n  td { \r\n    border: 1px solid var(--gray); \r\n    text-align: left;\r\n    width: var(--cell-width); \r\n    /* No overflow for menus */\r\n  }\r\n\r\n  th {\r\n    border-top: none;\r\n    color: var(--gray);\r\n    font-weight: normal;\r\n    padding: 12px 6px;\r\n  }\r\n\r\n  th:first-child { \r\n    border-left: none;\r\n  }\r\n\r\n  th:last-child { \r\n    border-right: none; \r\n  }\r\n\r\n  td:last-child { \r\n    border-right: none; \r\n  }\r\n\r\n  td:first-child { \r\n    text-align: center;\r\n    border-left: none;\r\n    color: var(--gray);\r\n    font-size: 0.7em;\r\n    width: 30px;\r\n  }\r\n\r\n  .cell {\r\n    position: relative;    \r\n    width: var(--cell-width); \r\n    \r\n    box-sizing: border-box;\r\n  }\r\n\r\n  .cell.selected {\r\n    outline: 2px solid var(--theme-secondary-color) !important;\r\n  }\r\n\r\n  .cell:focus-visible { \r\n    outline: none;   \r\n  }\r\n\r\n  .menu {\r\n    position: absolute;\r\n    display: none;\r\n    gap: 4px;\r\n    width: 260px;    \r\n    z-index: 1000;\r\n    background-color: #ffffff;\r\n    border-radius: 12px;\r\n    padding: 4px;\r\n    box-shadow: 2px 2px 5px #00000059;\r\n  }\r\n\r\n  .cell.selected .menu {    \r\n    display: flex;\r\n  }\r\n\r\n  .option {  \r\n    display: inline-block;  \r\n    padding: 6px;\r\n    background-color: #9898dc;\r\n    border-radius: 20px;\r\n  }\r\n\r\n  .text {word-wrap: break-word;\r\n    overflow: hidden; \r\n    white-space: nowrap;\r\n    overflow: hidden; \r\n    text-align: left;\r\n    padding: 12px 6px; \r\n  }\r\n\r\n  ::-webkit-scrollbar {\r\n    -webkit-appearance: none;\r\n    width: 8px;\r\n    height: 8px;\r\n  }\r\n\r\n  ::-webkit-scrollbar-button {\r\n    display: none;\r\n  }\r\n\r\n  ::-webkit-scrollbar-track {}\r\n\r\n  ::-webkit-scrollbar-track-piece {\r\n    background-color: var(--scrollbar-background);\r\n  }\r\n\r\n  ::-webkit-scrollbar-corner {\r\n    background-color: var(--scrollbar-background);\r\n  }\r\n\r\n  ::-webkit-scrollbar-thumb {\r\n    background-color: var(--scrollbar-foreground);\r\n    border-radius: 10px !important;\r\n  }\r\n\r\n`;\r\nclass DataGridComponent extends HTMLElement {\r\n    constructor() {\r\n        super();\r\n        this.shadow = this.attachShadow({ mode: 'open' });\r\n        this.htmlElement = document.createElement('div');\r\n        this.htmlElement.className = 'content';\r\n        this.styleElement = document.createElement('style');\r\n    }\r\n    connectedCallback() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.shadow.appendChild(this.styleElement);\r\n            this.shadow.appendChild(this.htmlElement);\r\n            this.styleElement.innerHTML = CssContent;\r\n            yield this.refresh();\r\n            yield this.postRefresh();\r\n        });\r\n    }\r\n    refresh() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.htmlElement.innerHTML = yield this.getHtmlContent();\r\n        });\r\n    }\r\n    getHtmlContent() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            console.log(\"this.data \", this.data);\r\n            const columns = this.getColumns();\r\n            return `\r\n      <table>\r\n        <tr>\r\n          <th></th>\r\n          ${columns.map(column => `<th>${column}</th>`).join('')}\r\n        </tr>\r\n        ${this.data.items.map((item, rowIndex) => `\r\n          \r\n          <tr>\r\n            <td>${rowIndex + 1}</td>\r\n            ${columns.map((column, columnIndex) => `\r\n\r\n              <td>\r\n                <div class=\"cell\"  data-row=\"${rowIndex}\" data-column=\"${columnIndex}\" >\r\n                  <div class=\"text\" contenteditable >${item[column]}</div>\r\n                  <div class=\"menu\" >\r\n                    <div class=\"option\" >Accepté</div>\r\n                    <div class=\"option\" >Rejeté</div>\r\n                    <div class=\"option\" >En attente</div>\r\n                  </div>\r\n                </div>\r\n              </td> \r\n            \r\n              `).join('')}\r\n          <tr>\r\n\r\n        `).join('')}          \r\n      </table>\r\n    `;\r\n        });\r\n    }\r\n    postRefresh() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            this.shadow.querySelectorAll('div[data-row]').forEach(cell => {\r\n                cell.addEventListener('click', (event) => {\r\n                    this.onCellClick(event);\r\n                });\r\n                cell.addEventListener('keydown', (event) => {\r\n                    this.onCellkeydown(event);\r\n                });\r\n            });\r\n        });\r\n    }\r\n    onCellkeydown(event) {\r\n        // Empêche le comportement par défaut (ajout d'un <div>)\r\n        if (event.key === 'Enter') {\r\n            event.preventDefault();\r\n            const br = document.createElement('br');\r\n            const selection = window.getSelection();\r\n            const range = selection.getRangeAt(0);\r\n            range.deleteContents();\r\n            range.insertNode(br);\r\n            range.setStartAfter(br);\r\n            range.collapse(true);\r\n            selection.removeAllRanges();\r\n            selection.addRange(range);\r\n        }\r\n    }\r\n    onCellClick(event) {\r\n        const cell = event.target.closest('.cell');\r\n        console.log(\"cell \", cell);\r\n        if (cell.classList.contains('selected')) {\r\n            // cell.setAttribute('contenteditable', '')\r\n            return;\r\n        }\r\n        const rowIndex = cell.dataset.row;\r\n        const columnIndex = cell.dataset.column;\r\n        const value = cell.textContent; // Contenu de la cellule\r\n        console.log('Cell clicked:', { rowIndex, columnIndex, value });\r\n        this.shadow.querySelectorAll('div[data-row]').forEach(cell => {\r\n            cell.classList.remove('selected');\r\n            // cell.removeAttribute('contenteditable')\r\n        });\r\n        cell.classList.add('selected');\r\n    }\r\n    getColumns() {\r\n        return Object.keys(this.data.items[0]).filter(k => k !== '_id' && k !== '_index');\r\n    }\r\n}\r\nzySdk.services.registry.registerComponent(DataGridMetadata, DataGridComponent);\r\n","const IconData = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"#cccccc\">    \r\n    <path d=\"M10,4V8H14V4H10M16,4V8H20V4H16M16,10V14H20V10H16M16,16V20H20V16H16M14,20V16H10V20H14M8,20V16H4V20H8M8,14V10H4V14H8M8,8V4H4V8H8M10,14H14V10H10V14M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4C2.92,22 2,21.1 2,20V4A2,2 0 0,1 4,2Z\" />\r\n  </svg> \r\n`;\r\nexport const DataGridMetadata = {\r\n    id: 'custom-datagrid',\r\n    metadataVersion: 2,\r\n    icon: IconData,\r\n    label: 'Data grid',\r\n    category: 'Plugins',\r\n    subCategory: 'Plugins',\r\n    hidden: false,\r\n    properties: [{\r\n            id: 'selection',\r\n            name: 'Selection',\r\n            type: 'row-variable',\r\n            tootip: '',\r\n            default: '',\r\n            write: true\r\n        }, {\r\n            id: 'data',\r\n            name: 'Table',\r\n            type: 'table',\r\n            tootip: 'The table being used to populate',\r\n            default: '',\r\n            main: true\r\n        }],\r\n    styles: []\r\n};\r\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","console","log","DataGridComponent","HTMLElement","constructor","super","this","shadow","attachShadow","mode","htmlElement","document","createElement","className","styleElement","connectedCallback","appendChild","innerHTML","refresh","postRefresh","getHtmlContent","data","columns","getColumns","map","column","join","items","item","rowIndex","columnIndex","querySelectorAll","forEach","cell","addEventListener","event","onCellClick","onCellkeydown","key","preventDefault","br","selection","window","getSelection","range","getRangeAt","deleteContents","insertNode","setStartAfter","collapse","removeAllRanges","addRange","target","closest","classList","contains","dataset","row","textContent","remove","add","Object","keys","filter","k","zySdk","services","registry","registerComponent","id","metadataVersion","icon","label","category","subCategory","hidden","properties","name","type","tootip","default","write","main","styles"],"sourceRoot":""}