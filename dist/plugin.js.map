{"version":3,"file":"plugin.js","mappings":"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","sources":["webpack://zyllio-plugin-datagrid/./src/datagrid.component.ts","webpack://zyllio-plugin-datagrid/./src/datagrid.metadata.ts"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nconsole.log('Plugin Datagrid started');\nimport { DataGridMetadata } from \"./datagrid.metadata\";\nimport CssContent from './datagrid.component.css';\nclass DataGridComponent extends HTMLElement {\n    constructor() {\n        super();\n        this.shadow = this.attachShadow({ mode: 'open' });\n        this.htmlElement = document.createElement('div');\n        this.htmlElement.className = 'content';\n        this.styleElement = document.createElement('style');\n    }\n    connectedCallback() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.shadow.appendChild(this.styleElement);\n            this.shadow.appendChild(this.htmlElement);\n            this.styleElement.innerHTML = CssContent;\n            yield this.refresh();\n            yield this.postRefresh();\n        });\n    }\n    refresh() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.htmlElement.innerHTML = yield this.getHtmlContent();\n        });\n    }\n    getHtmlContent() {\n        return __awaiter(this, void 0, void 0, function* () {\n            console.log(\"this.data \", this.data);\n            const columns = this.getColumns();\n            return `\r\n\r\n      <div class=\"header\">        \r\n        <zyllio-sdk-search></zyllio-sdk-search>\r\n      </div>\r\n\r\n      <table>\r\n        <thead><tr>\r\n          <th></th>\r\n          ${columns.map(column => `<th>${column.name}</th>`).join('')}\r\n        </tr></thead>\r\n\r\n        <tbody>\r\n        ${this.data.items.map((item, rowIndex) => `\r\n          \r\n          <tr>\r\n            <td>${rowIndex + 1}</td>\r\n            ${columns.map((column, columnIndex) => `\r\n\r\n              <td>\r\n                <div class=\"cell\"  data-row=\"${rowIndex}\" data-column=\"${columnIndex}\" >\r\n                  <div class=\"text\" contenteditable >${item[column.name]}</div>\r\n                  ${(column.type === 'options-1' || column.type === 'options-n') ?\n                `<div class=\"menu\" >\r\n                      ${column.options.split(',').map((option) => `<div class=\"option\" >${option}</div>`)}                      \r\n                    </div>` : ''}\r\n                </div>\r\n              </td> \r\n            \r\n              `).join('')}\r\n          <tr>\r\n\r\n        `).join('')} \r\n        </tbody>         \r\n      </table>\r\n    `;\n        });\n    }\n    postRefresh() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.shadow.querySelectorAll('div[data-row]').forEach(cell => {\n                cell.addEventListener('click', (event) => {\n                    this.onCellClick(event);\n                });\n                cell.addEventListener('keydown', (event) => {\n                    this.onCellkeydown(event);\n                });\n            });\n            this.shadow.querySelectorAll('.option').forEach(option => {\n                option.addEventListener('click', (event) => {\n                    this.onOptionClick(event);\n                });\n            });\n        });\n    }\n    onOptionClick(event) {\n        event.stopPropagation();\n        const option = event.target;\n        const cell = option.closest('.cell');\n        const text = cell.querySelector('.text');\n        text.textContent = option.innerText;\n        cell.classList.remove('selected');\n    }\n    onCellkeydown(event) {\n        // Empêche le comportement par défaut (ajout d'un <div>)\n        if (event.key === 'Enter') {\n            event.preventDefault();\n            const br = document.createElement('br');\n            const selection = window.getSelection();\n            const range = selection.getRangeAt(0);\n            range.deleteContents();\n            range.insertNode(br);\n            range.setStartAfter(br);\n            range.collapse(true);\n            selection.removeAllRanges();\n            selection.addRange(range);\n        }\n    }\n    onCellClick(event) {\n        const cell = event.target.closest('.cell');\n        if (cell.classList.contains('selected')) {\n            return;\n        }\n        const rowIndex = cell.dataset.row;\n        const columnIndex = cell.dataset.column;\n        console.log('Cell clicked:', { rowIndex, columnIndex });\n        this.shadow.querySelectorAll('div[data-row]').forEach(cell => {\n            cell.classList.remove('selected');\n        });\n        cell.classList.add('selected');\n    }\n    getColumns() {\n        // return Object.keys(this.data.items[0]).filter(k => k !== '_id' && k !== '_index')\n        return this.data.table.columns.filter(c => c.type !== 'relation-1' && c.type !== 'relation-n');\n    }\n}\nzySdk.services.registry.registerComponent(DataGridMetadata, DataGridComponent);\n","const IconData = `\r\n  <svg xmlns=\"http://www.w3.org/2000/svg\" version=\"1.1\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"#cccccc\">    \r\n    <path d=\"M10,4V8H14V4H10M16,4V8H20V4H16M16,10V14H20V10H16M16,16V20H20V16H16M14,20V16H10V20H14M8,20V16H4V20H8M8,14V10H4V14H8M8,8V4H4V8H8M10,14H14V10H10V14M4,2H20A2,2 0 0,1 22,4V20A2,2 0 0,1 20,22H4C2.92,22 2,21.1 2,20V4A2,2 0 0,1 4,2Z\" />\r\n  </svg> \r\n`;\nexport const DataGridMetadata = {\n    id: 'custom-datagrid',\n    metadataVersion: 2,\n    icon: IconData,\n    label: 'Data grid',\n    category: 'Plugins',\n    subCategory: 'Plugins',\n    hidden: false,\n    properties: [{\n            id: 'selection',\n            name: 'Selection',\n            type: 'row-variable',\n            tootip: '',\n            default: '',\n            write: true\n        }, {\n            id: 'data',\n            name: 'Table',\n            type: 'table',\n            tootip: 'The table being used to populate',\n            default: '',\n            main: true\n        }, {\n            id: 'update-action',\n            name: 'Update action',\n            type: 'action',\n            tootip: '',\n            default: ''\n        }, {\n            id: 'create-action',\n            name: 'Create action',\n            type: 'action',\n            tootip: '',\n            default: ''\n        }, {\n            id: 'delete-action',\n            name: 'Delete action',\n            type: 'action',\n            tootip: '',\n            default: ''\n        }],\n    styles: []\n};\n"],"names":["__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","apply","console","log","DataGridComponent","HTMLElement","constructor","super","this","shadow","attachShadow","mode","htmlElement","document","createElement","className","styleElement","connectedCallback","appendChild","innerHTML","refresh","postRefresh","getHtmlContent","data","columns","getColumns","map","column","name","join","items","item","rowIndex","columnIndex","type","options","split","option","querySelectorAll","forEach","cell","addEventListener","event","onCellClick","onCellkeydown","onOptionClick","stopPropagation","target","closest","querySelector","textContent","innerText","classList","remove","key","preventDefault","br","selection","window","getSelection","range","getRangeAt","deleteContents","insertNode","setStartAfter","collapse","removeAllRanges","addRange","contains","dataset","row","add","table","filter","c","zySdk","services","registry","registerComponent","id","metadataVersion","icon","label","category","subCategory","hidden","properties","tootip","default","write","main","styles"],"sourceRoot":""}